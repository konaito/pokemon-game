# ゲームシステムのメタ分解 — ポケモンを「機械」として理解する

## 0. 前提

前回のドキュメント（`meta-analysis-how-to-build-pokemon.md`）では「ポケモンとは何か」を体験設計の視点から分析した。
本ドキュメントでは一段深く、**ポケモンを構成するゲームシステムそのものを「機械の部品」として分解する**。

ゲームとはプレイヤーの入力を受け取り、状態を変化させ、フィードバックを返す**情報処理システム**である。
この視点から、ポケモンを完全に分解する。

---

## 1. 分析フレームワーク — 3つのレンズ

ゲームシステムを分解するために、3つの確立されたフレームワークを併用する。

### 1.1 MDAフレームワーク（Hunicke, LeBlanc, Zubek）

```
設計者の視点:  Mechanics → Dynamics → Aesthetics
プレイヤーの視点: Aesthetics → Dynamics → Mechanics
```

| 層 | 定義 | ポケモンでの具体例 |
|---|---|---|
| **Mechanics（メカニクス）** | ルール・データ・アルゴリズム | ダメージ計算式、捕獲率、経験値テーブル |
| **Dynamics（ダイナミクス）** | メカニクスが実行時に生む「振る舞い」 | 読み合い、パーティ構築のメタゲーム、レベル上げの快感 |
| **Aesthetics（エステティクス）** | プレイヤーが感じる「感情」 | 達成感、コレクション欲、友情、発見の喜び |

**設計上の教訓**: 作るのはMechanicsだけ。DynamicsとAestheticsは**設計できない — 発生させる**ものである。

### 1.2 エレメンタル・テトラッド（Jesse Schell）

```
        [Aesthetics（美的表現）]
       /                        \
[Story（物語）] ---- [Mechanics（メカニクス）]
       \                        /
        [Technology（技術）]
```

4つの要素は相互に制約し合う。例えば:
- **技術がメカニクスを制約する**: GBの通信速度が遅いから、リアルタイム対戦ではなくターン制になった
- **物語がメカニクスを動機づける**: 「チャンピオンになる」という物語があるからジムバッジを集める意味がある
- **美的表現がメカニクスを伝達する**: 炎ポケモンが赤いから、水に弱いと直感でわかる

### 1.3 形式的要素（Formal Elements）

ゲームを構成する最も基本的な要素:

| 要素 | 定義 | ポケモンでの実装 |
|---|---|---|
| **プレイヤー** | 意思決定の主体 | トレーナー（=プレイヤー自身） |
| **目標** | 何を達成すれば「勝ち」か | チャンピオン撃破 / 図鑑完成 / 対戦レート |
| **手続き** | プレイヤーが取れる行動 | 移動、会話、戦闘、捕獲、交換 |
| **ルール** | 行動の制約 | 技は4つまで、パーティは6匹まで |
| **リソース** | 管理すべき有限なもの | HP、PP、お金、ボール、技枠 |
| **境界** | ゲーム世界の範囲 | マップの端、ストーリーのゲート |
| **結果** | プレイ結果の多様性 | 勝利/敗北/捕獲成功/逃走 |
| **衝突** | 目標達成を阻む障害 | タイプ相性、レベル差、入手困難さ |

---

## 2. ステートマシンとしてのポケモン — ゲーム全体の状態遷移

ポケモンは巨大な**有限状態機械（Finite State Machine）**として捉えられる。

### 2.1 トップレベル状態

```
┌─────────────────────────────────────────────────────────┐
│                     GAME                                │
│                                                         │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐          │
│  │  TITLE   │───→│ OVERWORLD│←──→│  MENU    │          │
│  │  SCREEN  │    │          │    │(パーティ │          │
│  └──────────┘    └────┬─────┘    │ 図鑑,    │          │
│                       │          │ バッグ)  │          │
│                       ▼          └──────────┘          │
│                  ┌──────────┐                           │
│                  │ BATTLE   │                           │
│                  │          │                           │
│                  └────┬─────┘                           │
│                       │                                 │
│              ┌────────┼────────┐                        │
│              ▼        ▼        ▼                        │
│         ┌────────┐┌───────┐┌────────┐                  │
│         │WILD    ││TRAINER││SPECIAL │                   │
│         │BATTLE  ││BATTLE ││(ボス等)│                   │
│         └────────┘└───────┘└────────┘                  │
└─────────────────────────────────────────────────────────┘
```

### 2.2 バトル状態の詳細分解

これがゲームの**最も複雑な状態機械**である:

```
BATTLE_START
    │
    ▼
TURN_START
    │
    ▼
ACTION_SELECT ──────────────────────────┐
    │                                   │
    ├→ [たたかう] → MOVE_SELECT         │
    │                   │               │
    │                   ▼               │
    ├→ [バッグ]  → ITEM_SELECT          │
    │                   │               │
    ├→ [ポケモン] → PARTY_SELECT        │
    │                   │               │
    └→ [にげる]  → ESCAPE_CALC          │
                        │               │
                        ▼               │
              ACTION_RESOLUTION         │
                        │               │
    ┌───────────────────┤               │
    │                   │               │
    ▼                   ▼               │
PRIORITY_SORT    SWITCH_EXECUTE         │
    │                   │               │
    ▼                   │               │
MOVE_EXECUTE ◄──────────┘               │
    │                                   │
    ├→ HIT_CHECK (命中判定)             │
    │       │                           │
    │       ├→ HIT → DAMAGE_CALC        │
    │       │           │               │
    │       │           ▼               │
    │       │     EFFECT_APPLY          │
    │       │           │               │
    │       │           ▼               │
    │       │     HP_UPDATE             │
    │       │           │               │
    │       └→ MISS → MESSAGE           │
    │                                   │
    ▼                                   │
FAINT_CHECK                             │
    │                                   │
    ├→ 瀕死なし → TURN_END ────────────→┘
    │                 │
    ├→ 自分瀕死 → FORCE_SWITCH
    │                 │
    └→ 相手瀕死 → EXP_GAIN
                      │
                      ├→ 相手残り有 → TURN_END
                      └→ 相手全滅  → BATTLE_END
                                        │
                                        ├→ WIN  → REWARD
                                        └→ LOSE → BLACKOUT
```

### 2.3 設計上の洞察

この状態遷移図から読み取れる重要な点:

1. **決定ポイントは4つだけ**: たたかう/バッグ/ポケモン/にげる。プレイヤーの「意思決定の表面」は極めて小さい
2. **計算の深さは膨大**: 1つの「たたかう」の裏で、優先度判定→命中判定→ダメージ計算→追加効果→状態異常チェックと、5段階以上の処理が走る
3. **「シンプルに見えて深い」の正体**: 入力のシンプルさ × 処理の複雑さ = 学びやすく極めにくい

---

## 3. リソースシステム — ゲーム経済学

ポケモンには**複数のリソース経済**が同時に走っている。

### 3.1 リソースの分類

```
[消費型リソース — 使ったら減る]
├── HP         : 戦闘中の生命力。0で瀕死
├── PP         : 技の使用回数。0で使用不可
├── お金       : アイテム購入に使用
└── ボール類   : 捕獲に使用。投げたら消える

[蓄積型リソース — 増え続ける]
├── 経験値     : 一定量でレベルアップ
├── 図鑑データ : 見た/捕まえたが記録される
└── 努力値     : 倒したポケモンに応じて蓄積

[構造型リソース — 選択と制約]
├── 技枠 (4)   : どの4つを残すかの選択
├── パーティ (6): どの6匹を連れるかの選択
└── 持ち物 (1) : 何を持たせるかの選択

[隠れたリソース — プレイヤーが気づかないもの]
├── 個体値     : 捕獲時に決定。変更不可
├── 性格       : ステータス補正。変更不可（※最近は可能に）
└── 時間       : 最も貴重なリソース。レベル上げ、厳選に投資する
```

### 3.2 ソース（蛇口）とシンク（排水口）

ゲーム経済が崩壊しないために、リソースには「入ってくる場所」と「出ていく場所」がバランスされている:

```
[お金の経済]
  ソース: トレーナー戦勝利、アイテム売却、拾得
  シンク: ポケモンセンター（無料）、道具購入、技マシン購入

[HPの経済]
  ソース: 回復アイテム、ポケモンセンター（無限・無料）
  シンク: 被ダメージ、状態異常、毒ダメージ

[経験値の経済]
  ソース: 戦闘勝利（唯一のソース）
  シンク: なし（蓄積のみ。これが「時間投資」の本質）
```

### 3.3 ポケモンセンターの天才的設計

ポケモンセンターは**HP/PPの無限ソース**であり、かつ**無料**である。

これはゲーム経済の「安全弁」として機能する:
- 回復アイテムを買う「お金」が足りなくても詰まない
- ダンジョンの難易度を「ポケセンまでの距離」で制御できる
- プレイヤーが自由に試行錯誤できる（失敗のコストが低い）

**逆に言えば**: ポケセンを廃止するだけで、全く違うゲーム体験になる（サバイバル型）

### 3.4 「時間」という真のリソース

全てのリソースは最終的に**時間**に換算される:

```
レアポケモンの価値 = 遭遇確率の低さ × 捕獲の難しさ = 投入時間の多さ
高レベルポケモンの価値 = 経験値テーブル × 戦闘効率 = 投入時間の多さ
厳選されたポケモンの価値 = 理想個体値の確率 × 試行回数 = 投入時間の多さ
```

ポケモンの「交換」は本質的に**「時間の交換」**である。
自分が100時間かけて見つけたレアポケモンと、相手が100時間かけて育てた理想個体を交換する。
これがポケモンの社会性の根源。

---

## 4. フィードバックループ — ゲームを自走させる仕組み

### 4.1 正のフィードバックループ（スノーボール効果）

```
レベルが上がる → 強くなる → 戦闘に勝てる → 経験値が入る → レベルが上がる
     ↑                                                        │
     └────────────────────────────────────────────────────────┘
```

これだけだとゲームが簡単になりすぎる。ポケモンはこれを**2つの方法で制御**する:

1. **経験値カーブの急増**: 高レベルになるほど必要経験値が指数的に増える
2. **ジム/ストーリーのゲート**: 特定バッジがないと強い技が使えない/言うことを聞かない

### 4.2 負のフィードバックループ（ラバーバンド効果）

```
レベルが低すぎる → 相手が強い → でもレベル差ボーナスで経験値が多い → 急速にレベルアップ
```

ポケモンは**低レベルのプレイヤーを自動で引き上げる仕組み**を持っている。
逆に、レベルが高すぎると得られる経験値が減り、過剰な強さを抑制する。

### 4.3 タイプ相性が生むメタゲームループ

対戦環境レベルでの巨大なフィードバックループ:

```
[ガブリアスが強い]
    → みんなガブリアスを使う
        → 氷タイプ/フェアリーが増える
            → ガブリアスが使いにくくなる
                → 鋼タイプが増える
                    → 炎/格闘が増える
                        → 環境が一周する
```

この「メタゲームの循環」は、設計者がメンテナンスしなくても**プレイヤーコミュニティが勝手に回す**。
タイプ相性というメカニクスが、メタゲームというダイナミクスを永久に生成し続ける。

---

## 5. 進行制御システム — ゲートとペーシング

### 5.1 ゲートの種類

ポケモンは「どこまで進めるか」を複数の方法で制御する:

| ゲートの種類 | 実装方法 | 心理的効果 |
|---|---|---|
| **物理ゲート** | 木を切る（いあいぎり）、波に乗る（なみのり） | 「あの先に何がある」好奇心の蓄積 |
| **レベルゲート** | ジムリーダーの強さ | 育成の必要性を暗示 |
| **ストーリーゲート** | NPCが道を塞ぐ | 物語の順序を保証 |
| **知識ゲート** | タイプ相性を知らないと勝てない | 学習の動機づけ |
| **社会ゲート** | 通信交換でしか進化しない | 他者との接続を強制 |

### 5.2 難易度カーブ

```
難易度
  ▲
  │        ジム8  四天王
  │       ╱    ╲╱╲
  │     ╱          ╲ チャンピオン
  │   ╱              ╲╱╲
  │ ╱ ジム1-3                ╲
  │╱                           ╲──→ ポストゲーム
  └──────────────────────────────→ 時間

特徴:
- 序盤は緩やか（学習フェーズ）
- 中盤で急上昇（挑戦フェーズ）
- ジムごとに小さな山と谷（達成→休息→挑戦のリズム）
- チャンピオン戦が最大の山
- クリア後は自由（目標が消え、プレイヤー自身が目標を設定する）
```

### 5.3 「秘伝技」の設計的天才性と呪い

秘伝技（HM）は以下を同時に実現する:

- **進行制御**: 新しいエリアへのアクセスを段階的に開放
- **リソース制約**: 技枠4つのうち1つ以上を「移動用」に使わせる → バトル構成が制限される
- **世界の一貫性**: 「ポケモンの能力でフィールドを移動する」という物語的整合性

しかし同時に:
- 技枠を「無駄遣い」させる不満
- 「ひでん要員」という非戦闘ポケモンの出現

→ 後の世代でライドポケモンに置き換わった。**メカニクスの美しさとプレイヤー体験の衝突**の好例。

---

## 6. 情報の非対称性 — ゲームの深さの源泉

### 6.1 プレイヤーに見えるもの / 見えないもの

```
[見える情報]
├── 自分のポケモンの全ステータス
├── 相手のポケモンの種族（見た目）
├── 相手の現在HP（HPバー）
├── タイプ相性（色でわかる ※最近の作品）
└── 天候・フィールド状態

[見えない情報]
├── 相手の技構成（4つのうちどれを持っているか）
├── 相手の持ち物
├── 相手の努力値配分
├── 相手の残りポケモン構成
├── 相手のプレイヤーの意図（交換するか、攻撃するか）
└── ダメージの乱数（85-100%）
```

### 6.2 なぜこれが重要か

ポケモンバトルの深さは**不完全情報ゲーム**であることから生まれる:

- 将棋・チェス = 完全情報ゲーム（全ての情報が見える）
- ポケモン = **不完全情報ゲーム**（相手の手持ちの一部しかわからない）
- ポーカー = 不完全情報ゲーム（相手の手札が見えない）

ポケモンはポーカーに近い。だから**読み合い・ブラフ・リスク管理**が生まれる。

### 6.3 段階的情報開示（Progressive Revelation）

ゲーム全体も「情報が徐々に開示される」構造を持つ:

```
序盤: 3タイプ（草水火）しか知らない → 世界がシンプルに見える
中盤: 10タイプ以上を知る → 複雑さに気づく
終盤: 18タイプ全てを理解 → 奥深さに没入する
対戦: 種族値・個体値・努力値を知る → ゲームが「別物」になる
```

プレイヤーの知識量に応じて**同じゲームが違うゲームに変化する**。
これが「初心者も上級者も楽しい」の正体。

---

## 7. サブシステム相関図 — 全体像

全てのシステムがどう繋がっているかを俯瞰する:

```
┌─────────────────────────────────────────────────────────────────┐
│                         ポケモン全体像                          │
│                                                                 │
│  ┌──────────┐     ┌──────────┐     ┌──────────┐               │
│  │ エンカウ │────→│ バトル   │────→│ 経験値   │               │
│  │ ント     │     │ エンジン │     │ /報酬    │               │
│  └────┬─────┘     └────┬─────┘     └────┬─────┘               │
│       │                │                │                      │
│       │                ▼                ▼                      │
│       │          ┌──────────┐     ┌──────────┐               │
│       │          │ タイプ   │     │ レベル   │               │
│       │          │ 相性     │     │ /成長    │               │
│       │          └──────────┘     └────┬─────┘               │
│       │                                │                      │
│       ▼                                ▼                      │
│  ┌──────────┐                    ┌──────────┐                │
│  │ 捕獲     │───────────────────→│ パーティ │                │
│  │ システム │                    │ 管理     │                │
│  └────┬─────┘                    └────┬─────┘                │
│       │                               │                      │
│       ▼                               ▼                      │
│  ┌──────────┐     ┌──────────┐  ┌──────────┐                │
│  │ 図鑑     │     │ 進化     │  │ 技管理   │                │
│  │          │     │ システム │  │ (4枠)    │                │
│  └──────────┘     └──────────┘  └──────────┘                │
│       ▲                               ▲                      │
│       │           ┌──────────┐        │                      │
│       └──────────→│ 交換     │────────┘                      │
│                   │ システム │                                │
│                   └──────────┘                                │
│                        ▲                                      │
│                        │                                      │
│                   ┌──────────┐                                │
│                   │ 他の     │                                │
│                   │ プレイヤー│                                │
│                   └──────────┘                                │
│                                                                │
│  ─── 横断的関心事 ──────────────────────────────────          │
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────────┐           │
│  │ お金   │ │ 道具   │ │ マップ │ │ストーリー  │           │
│  │ 経済   │ │ 管理   │ │ /移動  │ │/ゲート     │           │
│  └────────┘ └────────┘ └────────┘ └────────────┘           │
└─────────────────────────────────────────────────────────────────┘
```

---

## 8. 実装への示唆 — 何から作るか、何を省くか

### 8.1 システムの依存関係（ビルド順序）

```
Layer 0: データ定義（Type, Stats, Species, Move）
    ↓
Layer 1: ダメージ計算 + タイプ相性
    ↓
Layer 2: バトルエンジン（ステートマシン）
    ↓
Layer 3: 捕獲メカニクス + パーティ管理
    ↓
Layer 4: エンカウント + マップ移動
    ↓
Layer 5: レベルアップ + 進化 + 技習得
    ↓
Layer 6: NPC + ストーリー + ゲート
    ↓
Layer 7: 図鑑 + 交換 + 対人戦
```

**各レイヤーは下のレイヤーに依存するが、上のレイヤーには依存しない。**
つまり、Layer 2（バトルエンジン）までで「遊べるプロトタイプ」が作れる。

### 8.2 各レイヤーの「最小実装」

| Layer | 最小実装 | テスト方法 |
|---|---|---|
| 0 | 5種のモンスター、10個の技、5タイプ | TypeScriptの型チェックが通る |
| 1 | 5×5の相性表、ダメージ計算関数 | ユニットテスト |
| 2 | CLI上で1vs1バトルが完走する | 手動プレイ |
| 3 | 野生戦で捕獲→パーティに追加 | 手動プレイ |
| 4 | テキストベースのマップ移動 | 手動プレイ |
| 5 | 戦闘後にレベルアップ→新技提案 | 手動プレイ |
| 6 | 1つのジムを含む線形ルート | 通しプレイ |
| 7 | ローカル2人対戦 | 2端末でテスト |

### 8.3 「省いてよいもの」の判断基準

省くべきかの判断は**「それがないとコアループが回らないか？」**で決める:

```
コアループ: 探索 → 遭遇 → 戦闘/捕獲 → 成長 → 探索

必須: バトル、捕獲、成長（レベル）、エンカウント
重要だが後回し可: 進化、図鑑、アイテム、NPC
なくても回る: 交換、対人戦、ストーリー、特性、天候
```

---

## 9. メタ視点のまとめ — ポケモンは「7つの機械」の複合体

```
┌─────────────────────────────────────────────┐
│         ポケモン = 7つの機械の複合体          │
│                                              │
│  1. じゃんけんマシン     （タイプ相性）       │
│  2. スロットマシン       （エンカウント）     │
│  3. 成長マシン           （経験値/レベル）    │
│  4. コレクションマシン   （図鑑/捕獲）       │
│  5. 最適化マシン         （パーティ構築）    │
│  6. 交渉マシン           （交換/対人戦）     │
│  7. 物語マシン           （ジム→チャンピオン）│
│                                              │
│  この7台が同時に回っているから、             │
│  プレイヤーは「どの機械で遊ぶか」を         │
│  自分で選べる。                               │
│  それがポケモンの懐の深さの正体。            │
└─────────────────────────────────────────────┘
```

**自分のゲームを作るとき、全部を同時に作る必要はない。**
**まず「じゃんけんマシン」と「成長マシン」を作れ。この2台が噛み合えば、ゲームは動き出す。**

---

## 参考資料

- [MDA: A Formal Approach to Game Design and Game Research](https://users.cs.northwestern.edu/~hunicke/MDA.pdf) — MDAフレームワーク原論文
- [Revisiting the MDA framework](https://www.gamedeveloper.com/design/revisiting-the-mda-framework) — MDA再考
- [The Elemental Tetrad - Wikipedia](https://en.wikipedia.org/wiki/Elemental_tetrad) — Jesse Schellのテトラッド
- [The formal systems of games](https://www.gamedeveloper.com/design/the-formal-systems-of-games) — ゲームの形式的システム
- [Formal Elements of Games](https://pressbooks.usnh.edu/creatinggames/chapter/formal-elements-of-games/) — ゲームの形式的要素
- [State Patterns in Game Programming](https://gameprogrammingpatterns.com/state.html) — ゲームプログラミングにおけるステートパターン
- [How to design a Pokémon-like Combat System](https://www.davideaversa.it/blog/how-to-design-a-pokemon-like-combat-system-chapter-1/) — ポケモン風戦闘システムの設計
- [Turn Structure, Speed, and Priority in Pokémon Battles](https://poketooling.com/info/articles/pokemon-games/game-mechanics/turn-structure-speed-and-priority) — ターン構造と優先度
- [Battle Mechanics - The Cave of Dragonflies](https://www.dragonflycave.com/mechanics/battle/) — バトルメカニクス詳解
- [Value Chains - Faucet-and-Drain Economies](https://lostgarden.com/2021/12/12/value-chains/) — ゲーム経済のバリューチェーン
- [Resources Loop - Deliberate Game Design](https://deliberategamedesign.com/resources-loop/) — リソースループ設計
- [Game Systems: Feedback Loops](https://machinations.io/articles/game-systems-feedback-loops-and-how-they-help-craft-player-experiences) — フィードバックループ
- [Feedback Loops - Game Design Toolkit](https://tkdev.dss.cloud/gamedesign/toolkit/feedback-loops/) — 正/負のフィードバック
- [Game Progression and Progression Systems](https://gamedesignskills.com/game-design/game-progression/) — 進行システム設計
- [RPG Level-based Progression Math](https://www.davideaversa.it/blog/gamedesign-math-rpg-level-based-progression/) — RPGレベルカーブの数学
- [Pokémon's progressive revelation](https://www.researchgate.net/publication/312301844_Pokemon_'s_progressive_revelation_Notes_on_20_years_of_game_design) — 段階的情報開示の20年
